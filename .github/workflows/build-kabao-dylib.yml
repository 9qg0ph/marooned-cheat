name: Build å¡åŒ…ä¿®ä»™ Dylib v2.0

on:
  push:
    paths:
      - 'å¡åŒ…ä¿®ä»™Dylib/**'
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Build KabaoCheat Dylib v2.0
      run: |
        cd å¡åŒ…ä¿®ä»™Dylib
        
        echo "ğŸ”¨ å¼€å§‹ç¼–è¯‘å¡åŒ…ä¿®ä»™ä¿®æ”¹å™¨ v2.0..."
        
        # ç¼–è¯‘ dylib
        clang -arch arm64 \
          -isysroot $(xcrun --sdk iphoneos --show-sdk-path) \
          -miphoneos-version-min=12.0 \
          -dynamiclib \
          -install_name @rpath/KabaoCheat.dylib \
          -framework UIKit \
          -framework Foundation \
          -framework CoreGraphics \
          -framework QuartzCore \
          -fobjc-arc \
          -O2 \
          -Wno-deprecated-declarations \
          -o KabaoCheat.dylib \
          KabaoCheat.m
        
        echo "âœ… ç¼–è¯‘å®Œæˆ!"
        
        # ç­¾å
        ldid -S KabaoCheat.dylib || codesign -f -s - KabaoCheat.dylib
        echo "âœ… ä»£ç ç­¾åå®Œæˆ"
        
        # éªŒè¯æ–‡ä»¶
        file KabaoCheat.dylib
        ls -lh KabaoCheat.dylib
        
        # åˆ›å»ºå‘å¸ƒä¿¡æ¯
        echo "# å¡åŒ…ä¿®ä»™ä¿®æ”¹å™¨ v2.0" > release-info.md
        echo "" >> release-info.md
        echo "## ğŸ“¦ ç¼–è¯‘ä¿¡æ¯" >> release-info.md
        echo "- **ç¼–è¯‘æ—¶é—´**: $(date)" >> release-info.md
        echo "- **æ¶æ„**: arm64" >> release-info.md
        echo "- **æœ€ä½iOSç‰ˆæœ¬**: 12.0" >> release-info.md
        echo "- **æ–‡ä»¶å¤§å°**: $(ls -lh KabaoCheat.dylib | awk '{print $5}')" >> release-info.md
        echo "" >> release-info.md
        echo "## ğŸ® åŠŸèƒ½ç‰¹æ€§" >> release-info.md
        echo "- âœ… æ— é™å¯¿å‘½ - ç”Ÿå‘½å€¼ä¸ä¼šå‡å°‘" >> release-info.md
        echo "- âœ… å†»ç»“çµçŸ³ - çµçŸ³æ•°é‡ä¿æŒä¸å˜" >> release-info.md
        echo "- âœ… æ— æ•Œå…ç–« - å…ç–«æ‰€æœ‰ä¼¤å®³" >> release-info.md
        echo "- âœ… æ— é™çªç ´ - æ— é™åˆ¶çªç ´ç­‰çº§" >> release-info.md
        echo "- âœ… å¢åŠ é€ƒè·‘æ¦‚ç‡ - å¤§å¹…æé«˜é€ƒè·‘æˆåŠŸç‡" >> release-info.md
        echo "" >> release-info.md
        echo "## ğŸš€ v2.0 æ–°ç‰¹æ€§" >> release-info.md
        echo "- ğŸ¨ å…¨æ–°UIè®¾è®¡ï¼Œæ”¯æŒæ¨¡ç³Šæ•ˆæœå’ŒåŠ¨ç”»" >> release-info.md
        echo "- ğŸ”§ å¤šæ–¹æ¡ˆå®ç°ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä½³æ–¹æ¡ˆ" >> release-info.md
        echo "- ğŸ“± é•¿æŒ‰æ‚¬æµ®æŒ‰é’®æ˜¾ç¤ºå¿«æ·èœå•" >> release-info.md
        echo "- ğŸ§  æ™ºèƒ½å†…å­˜æœç´¢å’Œä¿®æ”¹" >> release-info.md
        echo "- ğŸ”— è‡ªåŠ¨æ£€æµ‹å¹¶å…¼å®¹ ASWJGAMEPLUS" >> release-info.md
        echo "- ğŸ’¾ çŠ¶æ€ä¿å­˜å’Œæ¢å¤" >> release-info.md
        echo "- ğŸ¯ è§¦è§‰åé¦ˆå’Œè§†è§‰æ•ˆæœ" >> release-info.md
        echo "- ğŸ“Š å®æ—¶çŠ¶æ€ç›‘æ§" >> release-info.md
        echo "" >> release-info.md
        echo "## ğŸ“– ä½¿ç”¨æ–¹æ³•" >> release-info.md
        echo "1. ä½¿ç”¨ IPAPatcher æˆ– Sideloadly å°† dylib æ³¨å…¥åˆ°æ¸¸æˆ IPA" >> release-info.md
        echo "2. ç”¨ TrollStore å®‰è£…ä¿®æ”¹åçš„ IPA" >> release-info.md
        echo "3. å¯åŠ¨æ¸¸æˆï¼Œç­‰å¾…3ç§’åæ‚¬æµ®æŒ‰é’®å‡ºç°" >> release-info.md
        echo "4. ç‚¹å‡»æ‚¬æµ®æŒ‰é’®æ‰“å¼€åŠŸèƒ½èœå•" >> release-info.md
        echo "5. é•¿æŒ‰æ‚¬æµ®æŒ‰é’®æ˜¾ç¤ºå¿«æ·æ“ä½œèœå•" >> release-info.md
        echo "6. ä½¿ç”¨å¼€å…³æ§åˆ¶å„é¡¹åŠŸèƒ½çš„å¼€å¯/å…³é—­" >> release-info.md
        
    - name: Upload dylib
      uses: actions/upload-artifact@v4
      with:
        name: KabaoCheat-v2.0-dylib
        path: å¡åŒ…ä¿®ä»™Dylib/KabaoCheat.dylib
        
    - name: Upload release info
      uses: actions/upload-artifact@v4
      with:
        name: KabaoCheat-v2.0-info
        path: å¡åŒ…ä¿®ä»™Dylib/release-info.md