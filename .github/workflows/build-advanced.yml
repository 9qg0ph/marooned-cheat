name: Build WoduziCheat v16.0

on:
  push:
    branches: [ main ]
    paths:
      - 'æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/WoduziCheat.m'
      - '.github/workflows/build-advanced.yml'
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
        
    - name: Show build info
      run: |
        echo "ğŸš€ Building WoduziCheat v16.0 (Based on PlayGearLib.dylib Analysis)"
        echo "ğŸ“‹ Build Configuration:"
        echo "   Architecture: arm64"
        echo "   Min iOS Version: 14.0"
        echo "   Source: WoduziCheat.m"
        echo "   Output: WoduziCheat.dylib"
        echo "   Technology: Multi-layer Hook + Intelligent Recognition"
        
    - name: Build WoduziCheat v16.0
      run: |
        cd "æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib"
        
        # æ£€æŸ¥æºæ–‡ä»¶
        if [ ! -f "WoduziCheat.m" ]; then
          echo "âŒ Error: WoduziCheat.m not found"
          exit 1
        fi
        
        echo "ğŸ”¨ Compiling WoduziCheat v16.0..."
        
        # ç¼–è¯‘
        clang -arch arm64 \
          -isysroot $(xcrun --sdk iphoneos --show-sdk-path) \
          -miphoneos-version-min=14.0 \
          -dynamiclib \
          -framework UIKit \
          -framework Foundation \
          -fobjc-arc \
          -O2 \
          -o WoduziCheat.dylib \
          WoduziCheat.m
          
        # æ£€æŸ¥ç¼–è¯‘ç»“æœ
        if [ $? -eq 0 ]; then
          echo "âœ… WoduziCheat v16.0 compiled successfully!"
          ls -lh WoduziCheat.dylib
        else
          echo "âŒ Compilation failed!"
          exit 1
        fi
        
        # ä»£ç ç­¾å
        if command -v ldid &> /dev/null; then
          echo "ğŸ” Code signing with ldid..."
          ldid -S WoduziCheat.dylib
          echo "âœ… Code signing completed"
        else
          echo "âš ï¸ ldid not found, skipping code signing"
        fi
        
    - name: Create release info
      run: |
        cd "æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib"
        
        echo "ğŸ“Š Build Summary:" > build_info.txt
        echo "=================" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸš€ WoduziCheat v16.0 - PlayGearLib Technology Edition" >> build_info.txt
        echo "Based on deep analysis of PlayGearLib.dylib" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸ”§ Technical Features:" >> build_info.txt
        echo "â€¢ Multi-layer Hook system (NSUserDefaults + memcpy/memmove)" >> build_info.txt
        echo "â€¢ Intelligent value recognition engine (keyword + range detection)" >> build_info.txt
        echo "â€¢ PlayGearLib standard values (2.1B money/stamina, 100K health/mood)" >> build_info.txt
        echo "â€¢ Real-time interception statistics and monitoring" >> build_info.txt
        echo "â€¢ Modular architecture (WDZController + WDZGameManager)" >> build_info.txt
        echo "â€¢ Professional UI with advanced controls" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸ¯ Learned from PlayGearLib.dylib:" >> build_info.txt
        echo "â€¢ shenling control class design pattern" >> build_info.txt
        echo "â€¢ ImgTool data management class pattern" >> build_info.txt
        echo "â€¢ Multi-framework Hook architecture" >> build_info.txt
        echo "â€¢ Professional value standards (21äº¿/10ä¸‡)" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸ“ Output File:" >> build_info.txt
        if [ -f "WoduziCheat.dylib" ]; then
          echo "âœ… WoduziCheat.dylib - $(ls -lh WoduziCheat.dylib | awk '{print $5}')" >> build_info.txt
        fi
        echo "" >> build_info.txt
        echo "ğŸ• Build Time: $(date)" >> build_info.txt
        echo "ğŸ—ï¸ Built with GitHub Actions on macOS" >> build_info.txt
        echo "ğŸ“ Technology learned from PlayGearLib.dylib analysis" >> build_info.txt
        
        cat build_info.txt
        
    - name: Upload WoduziCheat v16.0
      uses: actions/upload-artifact@v4
      with:
        name: WoduziCheat-v16.0-PlayGearLib-Edition
        path: |
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/WoduziCheat.dylib
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/build_info.txt
        retention-days: 30
        
    - name: Upload Documentation
      uses: actions/upload-artifact@v4
      with:
        name: Technical-Documentation
        path: |
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/README.md
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/PlayGearLibæŠ€æœ¯å­¦ä¹ æŠ¥å‘Š.md
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/å¿«é€Ÿå¼€å§‹æŒ‡å—.md
          PlayGearLib_dylib_åˆ†ææŠ¥å‘Š.md
        retention-days: 30