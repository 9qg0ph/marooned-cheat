name: Build WoduziCheat Advanced v16.0

on:
  push:
    branches: [ main ]
    paths:
      - 'æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/WoduziCheat_Advanced.m'
      - '.github/workflows/build-advanced.yml'
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-advanced:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
        
    - name: Show build info
      run: |
        echo "ğŸš€ Building WoduziCheat Advanced v16.0"
        echo "ğŸ“‹ Build Configuration:"
        echo "   Architecture: arm64"
        echo "   Min iOS Version: 14.0"
        echo "   Source: WoduziCheat_Advanced.m"
        echo "   Output: WoduziCheat_Advanced.dylib"
        echo "   Based on: PlayGearLib.dylib technology analysis"
        
    - name: Build Advanced Version
      run: |
        cd "æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib"
        
        # æ£€æŸ¥æºæ–‡ä»¶
        if [ ! -f "WoduziCheat_Advanced.m" ]; then
          echo "âŒ Error: WoduziCheat_Advanced.m not found"
          exit 1
        fi
        
        echo "ğŸ”¨ Compiling WoduziCheat Advanced v16.0..."
        
        # ç¼–è¯‘é«˜çº§ç‰ˆæœ¬
        clang -arch arm64 \
          -isysroot $(xcrun --sdk iphoneos --show-sdk-path) \
          -miphoneos-version-min=14.0 \
          -dynamiclib \
          -framework UIKit \
          -framework Foundation \
          -fobjc-arc \
          -O2 \
          -o WoduziCheat_Advanced.dylib \
          WoduziCheat_Advanced.m
          
        # æ£€æŸ¥ç¼–è¯‘ç»“æœ
        if [ $? -eq 0 ]; then
          echo "âœ… Advanced version compiled successfully!"
          ls -lh WoduziCheat_Advanced.dylib
        else
          echo "âŒ Advanced version compilation failed!"
          exit 1
        fi
        
        # ä»£ç ç­¾å
        if command -v ldid &> /dev/null; then
          echo "ğŸ” Code signing with ldid..."
          ldid -S WoduziCheat_Advanced.dylib
          echo "âœ… Code signing completed"
        else
          echo "âš ï¸ ldid not found, skipping code signing"
        fi
        
    - name: Build Traditional Version (v15.3)
      run: |
        cd "æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib"
        
        echo "ğŸ”¨ Compiling WoduziCheat Traditional v15.3..."
        
        # ç¼–è¯‘ä¼ ç»Ÿç‰ˆæœ¬
        clang -arch arm64 \
          -isysroot $(xcrun --sdk iphoneos --show-sdk-path) \
          -miphoneos-version-min=14.0 \
          -dynamiclib \
          -framework UIKit \
          -framework Foundation \
          -fobjc-arc \
          -O2 \
          -o WoduziCheat.dylib \
          WoduziCheat.m
          
        # æ£€æŸ¥ç¼–è¯‘ç»“æœ
        if [ $? -eq 0 ]; then
          echo "âœ… Traditional version compiled successfully!"
          ls -lh WoduziCheat.dylib
        else
          echo "âŒ Traditional version compilation failed!"
          exit 1
        fi
        
        # ä»£ç ç­¾å
        if command -v ldid &> /dev/null; then
          echo "ğŸ” Code signing with ldid..."
          ldid -S WoduziCheat.dylib
          echo "âœ… Code signing completed"
        else
          echo "âš ï¸ ldid not found, skipping code signing"
        fi
        
    - name: Create release info
      run: |
        cd "æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib"
        
        echo "ğŸ“Š Build Summary:" > build_info.txt
        echo "=================" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸš€ WoduziCheat v16.0 Advanced Edition" >> build_info.txt
        echo "Based on PlayGearLib.dylib technology analysis" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸ“‹ Features:" >> build_info.txt
        echo "â€¢ Multi-layer Hook system (NSUserDefaults + memcpy/memmove)" >> build_info.txt
        echo "â€¢ Intelligent value recognition engine" >> build_info.txt
        echo "â€¢ PlayGearLib standard values (2.1B money/stamina, 100K health/mood)" >> build_info.txt
        echo "â€¢ Real-time interception statistics" >> build_info.txt
        echo "â€¢ Modular architecture (WDZController + WDZGameManager)" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸ›¡ï¸ WoduziCheat v15.3 Traditional Edition" >> build_info.txt
        echo "Stable manual guidance version" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸ“‹ Features:" >> build_info.txt
        echo "â€¢ Manual modification guidance" >> build_info.txt
        echo "â€¢ 100% crash-free (no automatic modifications)" >> build_info.txt
        echo "â€¢ Detailed iGameGod tutorials" >> build_info.txt
        echo "â€¢ Memory offset calculations" >> build_info.txt
        echo "" >> build_info.txt
        echo "ğŸ“ Files:" >> build_info.txt
        if [ -f "WoduziCheat_Advanced.dylib" ]; then
          echo "âœ… WoduziCheat_Advanced.dylib - $(ls -lh WoduziCheat_Advanced.dylib | awk '{print $5}')" >> build_info.txt
        fi
        if [ -f "WoduziCheat.dylib" ]; then
          echo "âœ… WoduziCheat.dylib - $(ls -lh WoduziCheat.dylib | awk '{print $5}')" >> build_info.txt
        fi
        echo "" >> build_info.txt
        echo "ğŸ• Build Time: $(date)" >> build_info.txt
        echo "ğŸ—ï¸ Built with GitHub Actions on macOS" >> build_info.txt
        
        cat build_info.txt
        
    - name: Upload Advanced Version
      uses: actions/upload-artifact@v4
      with:
        name: WoduziCheat-Advanced-v16.0
        path: |
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/WoduziCheat_Advanced.dylib
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/build_info.txt
        retention-days: 30
        
    - name: Upload Traditional Version  
      uses: actions/upload-artifact@v4
      with:
        name: WoduziCheat-Traditional-v15.3
        path: |
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/WoduziCheat.dylib
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/build_info.txt
        retention-days: 30
        
    - name: Upload All Documentation
      uses: actions/upload-artifact@v4
      with:
        name: Documentation-and-Analysis
        path: |
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/README.md
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/PlayGearLibæŠ€æœ¯å­¦ä¹ æŠ¥å‘Š.md
          æˆ‘ç‹¬è‡ªç”Ÿæ´»Dylib/å¿«é€Ÿå¼€å§‹æŒ‡å—.md
          PlayGearLib_dylib_åˆ†ææŠ¥å‘Š.md
        retention-days: 30