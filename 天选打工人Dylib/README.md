# 天选打工人修改器

## 📦 最新版本

**TianXuanCheat.m** - 稳定版（2026年1月18日更新）

## 🎯 功能特点

- ✅ 只修改数值，保留游戏进度
- ✅ 自动备份原存档，安全可靠
- ✅ 修改后自动重启游戏生效
- ✅ 解决数据库锁定问题，稳定不闪退
- ✅ 版权信息和图标URL加密保护
- ✅ 参考卡包修仙成功实现，UI美观

## 🎮 支持功能

| 功能 | 说明 |
|------|------|
| 💰 无限金钱 | 金钱设置为 999999999 |
| 🏆 无限金条 | 金条设置为 999999999 |
| ⚡ 无限体力 | 体力设置为 999999999 |
| 🎁 一键全开 | 金钱+金条+体力+心情100+积分全满 |

## 📝 使用方法

1. 下载编译好的 `TianXuanCheat.dylib`
2. 使用注入工具注入到游戏
3. 启动游戏，看到 **虎** 字悬浮按钮（会自动加载科技虎图标）
4. 点击按钮，选择要开启的功能
5. 确认后游戏会立即关闭
6. 手动重新打开游戏即可看到效果

## 🔧 编译方法

### GitHub Actions 自动编译
推送代码到 GitHub 后会自动编译，下载 Artifacts 中的 dylib 文件。

### 手动编译
```bash
clang -arch arm64 \
  -isysroot $(xcrun --sdk iphoneos --show-sdk-path) \
  -miphoneos-version-min=14.0 \
  -dynamiclib \
  -framework UIKit \
  -framework Foundation \
  -lsqlite3 \
  -fobjc-arc \
  -o TianXuanCheat.dylib \
  TianXuanCheat.m

ldid -S TianXuanCheat.dylib
```

## 💡 技术细节

### 存档结构
游戏使用 SQLite 数据库存储存档：
- 路径：`Documents/jsb.sqlite`
- 表名：`data`
- 键名：`012345678ssx45sss`（重要：不是 `ssx45sss`）
- 格式：JSON

### 数据结构
```json
{
  "info": {
    "money": 999999999,    // 金钱
    "mine": 999999999,     // 金条
    "power": 999999999,    // 体力
    "mood": 100,           // 心情
    "integral": 999999999  // 积分
  },
  "cards": [...],          // 卡牌数据（保留）
  "calendar": {...},       // 日历数据（保留）
  ...                      // 其他游戏进度（保留）
}
```

### 修改原理
1. 复制数据库到临时文件（避免锁定问题）
2. 读取 SQLite 数据库中的存档 JSON
3. 解析 JSON，只修改 `info` 字段中的数值
4. 保留所有其他游戏进度数据
5. 使用事务写回数据库
6. 替换原文件，自动重启游戏

### 关键技术突破
1. **数据库锁定问题** - 使用临时文件+事务解决
2. **存档key发现** - 通过日志调试发现正确key为 `012345678ssx45sss`
3. **版权保护** - Base64编码+动态拼接防止二进制修改
4. **UI优化** - 参考卡包修仙样式，添加免责声明

## 🛠️ 开发历程

### 尝试过的方案
1. **HTML + h5gg方案** - 失败（API限制）
2. **内存搜索方案** - 不稳定（需要特定条件）
3. **直接存档修改** - 多次闪退（数据库锁定）
4. **临时文件方案** - ✅ 成功解决所有问题

### 关键发现
- 存档key不是 `ssx45sss` 而是 `012345678ssx45sss`
- 游戏运行时数据库被锁定，需要使用临时文件
- 必须使用事务保证数据完整性

## ⚠️ 注意事项

1. 修改前会自动备份原存档到 `jsb.sqlite.backup`
2. 点击功能后游戏会立即关闭，这是正常现象
3. 手动重新打开游戏查看效果
4. 只修改数值，不会影响游戏进度和卡牌
5. 日志文件位置：`Documents/tianxuan_cheat.log`（可用Filza查看）

## 🔒 安全保护

- 版权信息 Base64 编码 + 动态拼接
- 图标URL Base64 编码 + 动态拼接  
- 防止二进制文件修改版权和图标

## 📄 免责声明

本工具仅供技术研究与学习，严禁用于商业用途及非法途径。使用本工具修改游戏可能违反游戏服务条款，用户需自行承担一切风险和责任。严禁倒卖、传播或用于牟利，否则后果自负。

## 📄 License

© 2026 𝐈𝐎𝐒𝐃𝐊 科技虎
